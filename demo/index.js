/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./demo.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./demo.js":
/*!*****************!*\
  !*** ./demo.js ***!
  \*****************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const jsonsql = __webpack_require__(/*! ./index */ \"./index.js\")\n\n\n/*\nconst result = jsonsql.compile(`\n@data{ /// + string,null 描述\n    @code 0 /// int 状态码\n    @list(2)[\n        @name '张三' /// string 姓名\n        @age [222212,33223332]?? /// string 年龄\n    ]\n}\n`)\n*/\n\nconst result = jsonsql.compile(`\n    abcd@aaaaaaa 888\n`)\n// @2age 1 /// + string,null 年龄\n// @age2 2 /// - string,nll 年龄2\n// @age3 3\n\nconsole.info(result)\n\n\nwindow.onfocus = function () {\n    // window.location.reload()\n}\n\n\n//# sourceURL=webpack:///./demo.js?");

/***/ }),

/***/ "./index.js":
/*!******************!*\
  !*** ./index.js ***!
  \******************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("module.exports = __webpack_require__(/*! ./lib2 */ \"./lib2/index.js\");\n\n//# sourceURL=webpack:///./index.js?");

/***/ }),

/***/ "./lib2/Compiler/Matchers.js":
/*!***********************************!*\
  !*** ./lib2/Compiler/Matchers.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar logger = {\n  created: false // 创建匹配器时\n\n};\nvar matchers = {};\n\nvar Matcher =\n/*#__PURE__*/\nfunction () {\n  function Matcher() {\n    _classCallCheck(this, Matcher);\n\n    logger.created && console.warn(\"new \".concat(this.constructor.name), this);\n  }\n\n  _createClass(Matcher, [{\n    key: \"suffixNum\",\n    value: function suffixNum(m, n) {\n      // 匹配次数\n      // ? = {0,1}\n      // * = {0,Infinity}\n      // + = {1,Infinity}\n      // {m,n} = {m,n}\n      this.m = m;\n      this.n = n;\n    }\n  }, {\n    key: \"scan\",\n    value: function scan() {\n      throw Error(\"Matcher.scan must be override by \".concat(this.constructor.name, \".scan\"));\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve() {\n      throw Error(\"Matcher.resolve must be override by \".concat(this.constructor.name, \".resolve\"));\n    }\n  }, {\n    key: \"reject\",\n    value: function reject() {\n      throw Error(\"Matcher.reject must be override by \".concat(this.constructor.name, \".reject\"));\n    } // 扫描真实的，非引用类型\n\n  }, {\n    key: \"scanRealMatcher\",\n    value: function scanRealMatcher(thisRuntime) {\n      for (var i = 0; i < this.m; i++) {\n        if (!thisRuntime.scanRealMatcher()) {\n          break;\n        }\n      }\n\n      if (thisRuntime.isSuccess) {\n        // 贪婪集\n        for (var _i = this.m; _i < this.n; _i++) {\n          if (!thisRuntime.scanRealMatcher(false)) {\n            break;\n          }\n        }\n      }\n    }\n  }]);\n\n  return Matcher;\n}();\n\nvar Matcher2 =\n/*#__PURE__*/\nfunction () {\n  function Matcher2() {\n    _classCallCheck(this, Matcher2);\n\n    logger.created && console.warn(\"new \".concat(this.constructor.name), this);\n  }\n\n  _createClass(Matcher2, [{\n    key: \"suffixNum\",\n    value: function suffixNum(m, n) {\n      // 匹配次数\n      // ? = {0,1}\n      // * = {0,Infinity}\n      // + = {1,Infinity}\n      // {m,n} = {m,n}\n      this.m = m;\n      this.n = n;\n    }\n  }, {\n    key: \"scan\",\n    value: function scan() {\n      throw Error(\"Matcher.scan must be override by \".concat(this.constructor.name, \".scan\"));\n    } // 扫描自己所有的分量{m,n}\n\n  }, {\n    key: \"scanAll\",\n    value: function scanAll(thisRuntime) {\n      for (var i = 0; i < this.n; i++) {\n        this.scanActivedMatcher(thisRuntime);\n      }\n    } // 所有的resolve和reject都是从根matcher抛出，中间级仅触发扫描\n\n  }, {\n    key: \"scanActivedMatcher\",\n    value: function scanActivedMatcher(thisRuntime) {\n      for (var i = 0; i < this.m; i++) {\n        if (!thisRuntime.scan()) {\n          break;\n        }\n      }\n\n      if (thisRuntime.isSuccess) {\n        // 贪婪集\n        for (var _i2 = this.m; _i2 < this.n; _i2++) {\n          if (!thisRuntime.scan(false)) {\n            break;\n          }\n        }\n      }\n    } // StringMatcher, RulerMatcher会触发resolve和reject，isRequired表示当前的匹配是否是必选的\n\n  }, {\n    key: \"match\",\n    value: function match(thisRuntime, isRequired) {\n      var sr = thisRuntime.sr;\n      var bIndex = sr.chIndex;\n      var isSuccess = true; // 扫描必选集\n\n      sr.addRecord();\n\n      for (var i = 0; i < this.m; i++) {\n        if (!this._match(sr)) {\n          isSuccess = false;\n          break;\n        }\n      }\n\n      if (isSuccess) {\n        sr.removeRecord(); // 销毁扫描器记录\n        // 贪婪集\n\n        for (var _i3 = this.m; _i3 < this.n; _i3++) {\n          if (!this._match(sr)) {\n            break;\n          }\n        }\n\n        thisRuntime.resolve(bIndex, sr.chIndex);\n      } else {\n        sr.rollback(); // 恢复扫描器记录\n\n        isRequired && thisRuntime.reject({\n          bIndex: bIndex,\n          matcher: this\n        });\n      }\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve() {\n      throw Error(\"Matcher.resolve must be override by \".concat(this.constructor.name, \".resolve\"));\n    }\n  }, {\n    key: \"resolveThis\",\n    value: function resolveThis(thisRuntime) {\n      // 存在兄弟节点，则继续扫描，否则触发父节点resolve\n      if (this.nextSibling) {\n        this.nextSibling.scan(thisRuntime.parent);\n      } else {\n        thisRuntime.parent.resolve();\n      }\n    }\n  }, {\n    key: \"reject2\",\n    value: function reject2() {\n      throw Error(\"Matcher.reject must be override by \".concat(this.constructor.name, \".reject\"));\n    }\n  }]);\n\n  return Matcher2;\n}();\n\nMatcher.prototype.m = Matcher.prototype.n = 1;\n\nvar RootMatcher = function RootMatcher(resolve, reject) {\n  _classCallCheck(this, RootMatcher);\n\n  this.resolve = resolve;\n  this.reject = reject;\n};\n\nvar HookMatcher =\n/*#__PURE__*/\nfunction (_Matcher) {\n  _inherits(HookMatcher, _Matcher);\n\n  function HookMatcher(id, _ref) {\n    var _this;\n\n    var before = _ref.before,\n        done = _ref.done,\n        source = _ref.source;\n\n    _classCallCheck(this, HookMatcher);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(HookMatcher).call(this));\n    _this._id = id;\n    _this._hooks = {\n      before: before,\n      done: done\n    };\n    _this._source = source;\n    _this._realMatcher = _this._parseSource(id, source);\n    matchers[id] = _assertThisInitialized(_this);\n    return _this;\n  }\n\n  _createClass(HookMatcher, [{\n    key: \"_parseSource\",\n    value: function _parseSource(id, source) {\n      var curMatcher;\n\n      if (typeof source === 'function') {\n        curMatcher = new GroupMatcher(id);\n        curMatcher.putChild(new RuleMatcher(id, source));\n        curMatcher.putEnd();\n        return curMatcher;\n      }\n\n      var groupStack = [];\n      var groupParserRegExp = RegExp([/'((?:[^']|\\\\\\\\|\\\\')+)'/, // 匹配字符串\n      /<(\\w+)>/, // 匹配link\n      /(\\()/, /(\\))/, // 匹配分组\n      /([?*+]|\\{\\d+\\}|\\{\\d+,(?:\\d+)?\\}|\\{,\\d+\\})/, // \"?\", \"*\", \"+\", \"{n}\", \"{m,}\", \"{m,n}\", \"{,n}\"\n      /(\\|)/ // \"|\"\n      ].map(function (item) {\n        return item.source;\n      }).join('|'), 'g');\n\n      var groupStackTop = function groupStackTop() {\n        return groupStack[groupStack.length - 1];\n      };\n\n      var groupParser = function groupParser(all, matchString, matchLinkName, matchGroupOpen, matchGroupClose, matchSuffixNum, matchOr) {\n        switch (false) {\n          case !matchString:\n            {\n              curMatcher = groupStackTop();\n              var newMatcher = new StringMatcher(matchString);\n              curMatcher.putChild(newMatcher);\n              curMatcher = newMatcher;\n              break;\n            }\n\n          case !matchLinkName:\n            {\n              curMatcher = groupStackTop();\n\n              var _newMatcher = new LinkMatcher(matchLinkName);\n\n              curMatcher.putChild(_newMatcher);\n              curMatcher = _newMatcher;\n              break;\n            }\n\n          case !matchGroupOpen:\n            {\n              curMatcher = groupStackTop();\n\n              var _newMatcher2 = new GroupMatcher();\n\n              curMatcher.putChild(_newMatcher2);\n              curMatcher = _newMatcher2;\n              groupStack.push(curMatcher);\n              break;\n            }\n\n          case !matchGroupClose:\n            {\n              curMatcher = groupStack.pop();\n              curMatcher.putEnd();\n              break;\n            }\n\n          case !matchSuffixNum:\n            {\n              switch (matchSuffixNum) {\n                case '?':\n                  {\n                    curMatcher.suffixNum(0, 1);\n                    break;\n                  }\n\n                case '*':\n                  {\n                    curMatcher.suffixNum(0, Infinity);\n                    break;\n                  }\n\n                case '+':\n                  {\n                    curMatcher.suffixNum(1, Infinity);\n                    break;\n                  }\n\n                default:\n                  {\n                    matchSuffixNum = matchSuffixNum.slice(1, -1).split(',');\n\n                    if (matchSuffixNum.length === 1) {\n                      curMatcher.suffixNum(+matchSuffixNum[0], +matchSuffixNum[0]);\n                    } else {\n                      curMatcher.suffixNum(+matchSuffixNum[0] || 0, +matchSuffixNum[1] || Infinity);\n                    }\n                  }\n              }\n\n              break;\n            }\n\n          case !matchOr:\n            {\n              curMatcher = groupStackTop();\n              curMatcher.putOr();\n              break;\n            }\n        }\n      };\n\n      if (typeof source === 'string') {\n        curMatcher = new GroupMatcher(id);\n        groupStack.push(curMatcher);\n        source.replace(/\\/\\/\\/|\\/\\*[\\w\\W]*\\*\\//g, '').replace(groupParserRegExp, groupParser);\n        curMatcher = groupStack.pop();\n        curMatcher.putEnd();\n        return curMatcher;\n      }\n\n      throw Error(\"Compiler.option.mathcers.\".concat(this.key, \".source must be a function or string\"));\n    }\n  }, {\n    key: \"scan\",\n    value: function scan(parentRuntime) {\n      this._realMatcher.scan(parentRuntime.createChild(this));\n    }\n  }, {\n    key: \"resolve2\",\n    value: function resolve2(thisRuntime) {\n      this.resolveThis(thisRuntime);\n    }\n  }]);\n\n  return HookMatcher;\n}(Matcher);\n\nvar GroupMatcher =\n/*#__PURE__*/\nfunction (_Matcher2) {\n  _inherits(GroupMatcher, _Matcher2);\n\n  function GroupMatcher() {\n    var _this2;\n\n    _classCallCheck(this, GroupMatcher);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(GroupMatcher).call(this));\n    _this2._tempOr = null;\n    _this2._tempAnd = null;\n    _this2._orFirstChild = null;\n    return _this2;\n  } // 插入子级\n\n\n  _createClass(GroupMatcher, [{\n    key: \"putChild\",\n    value: function putChild(matcher) {\n      var _tempOr = this._tempOr,\n          _tempAnd = this._tempAnd;\n\n      if (_tempOr) {\n        // 已经存在or节点\n        // 继续添加and节点\n        if (_tempAnd) {\n          _tempAnd.nextSibling = matcher;\n          matcher.previousSibling = _tempAnd;\n          this._tempAnd = matcher;\n        } else {\n          this._tempOr = _tempOr.nextSibling = {\n            andFirstChild: this._tempAnd = matcher\n          };\n        }\n      } else {\n        this._orFirstChild = this._tempOr = {\n          andFirstChild: this._tempAnd = matcher\n        };\n      }\n\n      matcher.parentNode = this;\n      this._tempAnd.groupParent = this._tempOr; // 子级链回父级分组or，回溯的使用使用\n    }\n  }, {\n    key: \"putOr\",\n    value: function putOr() {\n      this._tempAnd = null;\n    }\n  }, {\n    key: \"putEnd\",\n    value: function putEnd() {\n      delete this._tempOr;\n      delete this._tempAnd;\n    }\n  }, {\n    key: \"scan\",\n    value: function scan(parentRuntime) {\n      this._orFirstChild.andFirstChild.scan(parentRuntime.createChild(this));\n    }\n  }, {\n    key: \"resolve222\",\n    value: function resolve222(thisRuntime) {// this.resolveThis(thisRuntime)\n    }\n  }]);\n\n  return GroupMatcher;\n}(Matcher);\n\nvar LinkMatcher =\n/*#__PURE__*/\nfunction (_Matcher3) {\n  _inherits(LinkMatcher, _Matcher3);\n\n  function LinkMatcher(id) {\n    var _this3;\n\n    _classCallCheck(this, LinkMatcher);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(LinkMatcher).call(this));\n    _this3._id = id;\n    return _this3;\n  }\n\n  _createClass(LinkMatcher, [{\n    key: \"scan\",\n    value: function scan(parentRuntime) {\n      var thisRuntime = parentRuntime.createChild(this);\n\n      for (var i = 0; i < this.m; i++) {\n        matchers[this._id].scan(thisRuntime);\n      }\n\n      for (var _i4 = this.m; _i4 < this.n; _i4++) {\n        matchers[this._id].scan(thisRuntime);\n      }\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(thisRuntime) {\n      thisRuntime.matches++; // 完成所有匹配\n\n      if (thisRuntime.matches === this.n) {\n        this.resolveAll(thisRuntime);\n      }\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(thisRuntime, error) {\n      if (thisRuntime.matches >= this.m) {\n        this.resolveAll(thisRuntime);\n      } else {\n        this.rejectAll(thisRuntime, error);\n      }\n    }\n  }, {\n    key: \"resolveAll\",\n    value: function resolveAll(thisRuntime) {\n      console.info('LinkMatcher.resolveAll', thisRuntime);\n    }\n  }, {\n    key: \"rejectAll\",\n    value: function rejectAll(thisRuntime, error) {\n      console.info('LinkMatcher.rejectAll', thisRuntime);\n    }\n  }, {\n    key: \"resolve2\",\n    value: function resolve2(thisRuntime) {\n      throw Error('xx');\n      console.info('resolve'); // this.resolveThis(thisRuntime)\n    }\n  }]);\n\n  return LinkMatcher;\n}(Matcher);\n\nvar RuleMatcher =\n/*#__PURE__*/\nfunction (_Matcher4) {\n  _inherits(RuleMatcher, _Matcher4);\n\n  function RuleMatcher(id, match) {\n    var _this4;\n\n    _classCallCheck(this, RuleMatcher);\n\n    _this4 = _possibleConstructorReturn(this, _getPrototypeOf(RuleMatcher).call(this));\n    _this4._id = id;\n    _this4._match = match;\n    matchers[id] = _assertThisInitialized(_this4);\n    return _this4;\n  }\n\n  _createClass(RuleMatcher, [{\n    key: \"scan\",\n    value: function scan(parentRuntime) {\n      var thisRuntime = parentRuntime.createChild(this);\n      var sr = parentRuntime.sr;\n      var bIndex = sr.chIndex;\n      sr.createRecord();\n\n      if (this._match(sr)) {\n        sr.removeRecord();\n        thisRuntime.resolve(bIndex, sr.chIndex);\n      } else {\n        sr.rollback();\n        thisRuntime.reject({\n          bIndex: bIndex,\n          stack: []\n        });\n      }\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(thisRuntime) {\n      thisRuntime.parent.resolve();\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(thisRuntime, error) {\n      error.stack.push(this);\n      thisRuntime.parent.reject(error);\n    }\n  }, {\n    key: \"scan2\",\n    value: function scan2(parentRuntime) {\n      this.match(parentRuntime.createChild(this, {\n        activedMatcher: this\n      }));\n    }\n  }, {\n    key: \"resolve2\",\n    value: function resolve2(thisRuntime) {\n      this.resolveThis(thisRuntime);\n    }\n  }]);\n\n  return RuleMatcher;\n}(Matcher);\n\nvar StringMatcher =\n/*#__PURE__*/\nfunction (_Matcher5) {\n  _inherits(StringMatcher, _Matcher5);\n\n  function StringMatcher(stringValue) {\n    var _this5;\n\n    _classCallCheck(this, StringMatcher);\n\n    _this5 = _possibleConstructorReturn(this, _getPrototypeOf(StringMatcher).call(this));\n    _this5._stringValue = stringValue;\n    return _this5;\n  }\n\n  _createClass(StringMatcher, [{\n    key: \"scan2\",\n    value: function scan2(parentRuntime, isRequired) {\n      this.match(parentRuntime.createChild(this, {\n        activedMatcher: this\n      }));\n    }\n  }, {\n    key: \"resolve2\",\n    value: function resolve2(thisRuntime) {\n      this.resolveThis(thisRuntime);\n    }\n  }, {\n    key: \"_match2\",\n    value: function _match2(sr) {\n      var stringValue = this._stringValue;\n\n      for (var i = 0, lg = stringValue.length; i < lg; i++) {\n        if (sr.read() !== stringValue[i]) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }]);\n\n  return StringMatcher;\n}(Matcher);\n\nmodule.exports = {\n  RootMatcher: RootMatcher,\n  RuleMatcher: RuleMatcher,\n  HookMatcher: HookMatcher\n};\n\n//# sourceURL=webpack:///./lib2/Compiler/Matchers.js?");

/***/ }),

/***/ "./lib2/Compiler/index.js":
/*!********************************!*\
  !*** ./lib2/Compiler/index.js ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar _require = __webpack_require__(/*! ./Matchers */ \"./lib2/Compiler/Matchers.js\"),\n    RuleMatcher = _require.RuleMatcher,\n    HookMatcher = _require.HookMatcher;\n\nvar scanner = __webpack_require__(/*! ./scanner */ \"./lib2/Compiler/scanner/index.js\");\n\nvar Compiler =\n/*#__PURE__*/\nfunction () {\n  function Compiler(_ref) {\n    var matchers = _ref.matchers;\n\n    _classCallCheck(this, Compiler);\n\n    this._matchers = {};\n\n    this._initSystemMatchers();\n\n    this._initCustomMatchers(matchers);\n  }\n\n  _createClass(Compiler, [{\n    key: \"_initSystemMatchers\",\n    value: function _initSystemMatchers() {\n      var matchers = this._matchers;\n      [['w', function (sr) {\n        return /\\w/.test(sr.read());\n      }], ['W', function (sr) {\n        return /\\W/.test(sr.read());\n      }], ['d', function (sr) {\n        return /\\d/.test(sr.read());\n      }], ['D', function (sr) {\n        return /\\D/.test(sr.read());\n      }], ['s', function (sr) {\n        return /\\s/.test(sr.read());\n      }], ['S', function (sr) {\n        return /\\S/.test(sr.read());\n      }], ['eol', function (sr) {\n        return sr.read() === sr.EOL;\n      }], ['.', function (sr) {\n        return sr.read() !== sr.EOL;\n      }]].forEach(function (_ref2) {\n        var _ref3 = _slicedToArray(_ref2, 2),\n            id = _ref3[0],\n            pattern = _ref3[1];\n\n        matchers[id] = new RuleMatcher(id, pattern);\n      });\n    }\n  }, {\n    key: \"_initCustomMatchers\",\n    value: function _initCustomMatchers(matcherOptions) {\n      var matchers = this._matchers;\n\n      for (var id in matcherOptions) {\n        matchers[id] = new HookMatcher(id, matcherOptions[id], this);\n      }\n    }\n  }, {\n    key: \"run\",\n    value: function run(code) {\n      var id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'main';\n      var sr = scanner(code);\n      var mainMatcher = this._matchers[id];\n      var maxNum = 0;\n\n      try {\n        while (sr.notEOF() && maxNum++ < 1) {\n          sr.use(mainMatcher);\n        }\n\n        return sr.tree();\n      } catch (err) {\n        return sr.error(err);\n      }\n    }\n  }, {\n    key: \"compile\",\n    value: function compile(code) {\n      console.info(\"input compile code is \\u3010\".concat(code, \"\\u3011\"), this);\n    }\n  }]);\n\n  return Compiler;\n}();\n\nmodule.exports = Compiler;\n\n//# sourceURL=webpack:///./lib2/Compiler/index.js?");

/***/ }),

/***/ "./lib2/Compiler/scanner/Runtime.js":
/*!******************************************!*\
  !*** ./lib2/Compiler/scanner/Runtime.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar logger = {\n  scaning: true,\n  resolve: true,\n  reject: true\n};\nvar PID = 0;\n\nvar Runtime =\n/*#__PURE__*/\nfunction () {\n  function Runtime(parent, matcher, extral) {\n    _classCallCheck(this, Runtime);\n\n    this.PID = PID++;\n    this.parent = parent;\n    this.matcher = matcher;\n    this.matchs = 0;\n    this.isSuccess = true;\n\n    if (parent) {\n      this.sr = parent.sr;\n    }\n\n    if (extral) {\n      Object.assign(this, extral);\n    }\n\n    logger.scaning && console.warn(\"\".concat(matcher.constructor.name, \".scan\"), this);\n  }\n\n  _createClass(Runtime, [{\n    key: \"createChild\",\n    value: function createChild(matcher, extral) {\n      return new Runtime(this, matcher, extral);\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(bIndex, eIndex) {\n      if (bIndex !== undefined) {\n        this.bIndex = bIndex;\n        this.eIndex = eIndex;\n      }\n\n      this.appendTo(this.parent);\n      this.matcher.resolve(this);\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(error) {\n      this.matcher.reject(this, error);\n    }\n  }, {\n    key: \"appendTo\",\n    value: function appendTo(parentRuntime) {\n      if (parentRuntime.lastChild) {\n        parentRuntime.lastChild.nextSibling = this;\n        this.previousSibling = parentRuntime.lastChild;\n        parentRuntime.lastChild = this;\n      } else {\n        parentRuntime.firstChild = parentRuntime.lastChild = this;\n        parentRuntime.bIndex = this.bIndex;\n      }\n\n      parentRuntime.eIndex = this.eIndex;\n      logger.resolve && console.warn(\"\".concat(this.matcher.constructor.name, \".resolve \").concat(this.sr.text(this.bIndex, this.eIndex)), this);\n    }\n  }, {\n    key: \"scanRealMatcher\",\n    value: function scanRealMatcher(isRequired) {\n      this.scanRealMatcher.scan(this, isRequired);\n      return this.isSuccess;\n    }\n  }, {\n    key: \"scan\",\n    value: function scan(isRequired) {\n      this.activedMatcher.scan(this, isRequired);\n      return this.isSuccess;\n    }\n  }, {\n    key: \"resolve222\",\n    value: function resolve222(bIndex, eIndex) {\n      if (bIndex !== undefined) {\n        this.bIndex = bIndex;\n        this.eIndex = eIndex;\n      }\n\n      this.appendTo(this.parent);\n      this.activedMatcher.resolve(this);\n    }\n  }, {\n    key: \"reject2\",\n    value: function reject2(error) {\n      this.matcher.reject(this, error);\n    } // 以下全部废弃\n    // 压入回溯点\n\n  }, {\n    key: \"createBacktracking2\",\n    value: function createBacktracking2(range) {\n      this.greedys = this.greedys || [];\n      this.greedys.push(range);\n      this.parent.backtrackingStack = this.parent.backtrackingStack || [];\n      this.parent.backtrackingStack.push(this);\n    } // 弹出回溯点\n\n  }, {\n    key: \"popBacktracking2\",\n    value: function popBacktracking2() {\n      var childRuntime = this.backtrackingStack.pop();\n\n      var _childRuntime$greedys = childRuntime.greedys.pop(),\n          bIndex = _childRuntime$greedys.bIndex; // 移除贪婪缓冲区\n\n\n      childRuntime.sr.moveTo(bIndex); // 移动扫描指针\n\n      childRuntime.setRange({\n        eIndex: bIndex\n      }); // 设置新的区间\n\n      if (this.backtrackingStack.length === 0) {\n        this.backtrackingStack = null;\n      }\n\n      return childRuntime;\n    } // 读取回溯点\n\n  }, {\n    key: \"getBacktracking2\",\n    value: function getBacktracking2() {\n      return this.backtrackingStack[this.backtrackingStack.length - 1];\n    }\n  }, {\n    key: \"pushGreedy2\",\n    value: function pushGreedy2(range) {\n      this.greedys = this.greedys || [];\n      this.greedys.push(range);\n    }\n  }, {\n    key: \"popGreedy2\",\n    value: function popGreedy2() {\n      return this.greedys.pop();\n    } // 设置匹配结果区间\n\n  }, {\n    key: \"setRange2\",\n    value: function setRange2(range) {\n      'bIndex' in range && (this.bIndex = range.bIndex);\n      'eIndex' in range && (this.eIndex = range.eIndex);\n    }\n  }, {\n    key: \"setLastChild2\",\n    value: function setLastChild2(childRuntime) {\n      childRuntime.nextSibling = null;\n      this.lastChild = childRuntime;\n    }\n  }, {\n    key: \"resolve2\",\n    value: function resolve2(range) {\n      this.setRange(range);\n      console.warn(\"\".concat(this.matcher.constructor.name, \".resolve matched:\").concat(this.sr.text(range.bIndex, range.eIndex)), this);\n      this.parent.matcher.resolve(this, this.parent);\n    }\n  }, {\n    key: \"reject2\",\n    value: function reject2(error) {\n      console.warn(\"\".concat(this.matcher.constructor.name, \".reject\"), this);\n      error.stack.push(this.parent.matcher);\n      this.parent.matcher.reject(this, error);\n    }\n  }]);\n\n  return Runtime;\n}();\n\nmodule.exports = Runtime;\n\n//# sourceURL=webpack:///./lib2/Compiler/scanner/Runtime.js?");

/***/ }),

/***/ "./lib2/Compiler/scanner/index.js":
/*!****************************************!*\
  !*** ./lib2/Compiler/scanner/index.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nvar Runtime = __webpack_require__(/*! ./Runtime */ \"./lib2/Compiler/scanner/Runtime.js\");\n\nvar _require = __webpack_require__(/*! ../Matchers */ \"./lib2/Compiler/Matchers.js\"),\n    RootMatcher = _require.RootMatcher;\n\nmodule.exports = scanner;\n\nfunction scanner(code) {\n  var BOF = {},\n      EOF = {},\n      EOL = '\\n';\n  var chAlls = [],\n      chMaps = [];\n\n  (function () {\n    var lineNum = -1; // 原始行标，因为要对空行进行过滤\n\n    code.split(/\\r\\n?|\\r?\\n/).forEach(function (line) {\n      line = line.trim();\n      lineNum++;\n\n      if (!line) {\n        return;\n      }\n\n      var document;\n      line = line.replace(/\\/\\/(\\/)? .+/, function (matched, isDocument) {\n        if (isDocument) {\n          document = matched;\n        }\n\n        return '';\n      }).trim();\n\n      if (!line) {\n        return;\n      }\n\n      var bIndex = chAlls.length;\n      chAlls.push.apply(chAlls, _toConsumableArray(line.split('')).concat(['\\n']));\n      var eIndex = chAlls.length;\n      chMaps.push([lineNum, bIndex, eIndex, document]);\n    });\n  })();\n\n  var recordStack = [];\n  var sr = {\n    EOF: EOF,\n    EOL: EOL,\n    chIndex: 0,\n    chNow: BOF,\n    notEOF: function notEOF() {\n      return sr.chIndex < chAlls.length;\n    },\n    use: function use(matcher) {\n      console.info('use', sr.chIndex, chAlls);\n      matcher.scan(new Runtime(null, new RootMatcher(function (thisRuntime) {\n        console.info('resolve===', thisRuntime);\n      }, function (thisRuntime, error) {\n        console.error(error);\n        throw Error('解析出错啦');\n      }), {\n        sr: sr\n      }));\n    },\n    read: function read() {\n      if (sr.chIndex === chAlls.length) {\n        // 处于文件结尾\n        throw Error('ch已经到达结尾');\n      }\n\n      return sr.chNow = chAlls[sr.chIndex++];\n    },\n    back: function back() {\n      return sr.chNow = chAlls[--sr.chIndex];\n    },\n    error: function error(err) {\n      console.error(err);\n    },\n    moveTo: function moveTo(chIndex) {\n      return sr.chNow = chAlls[sr.chIndex = chIndex];\n    },\n    createRecord: function createRecord() {\n      return recordStack.push(sr.chIndex);\n    },\n    removeRecord: function removeRecord() {\n      return recordStack.pop();\n    },\n    rollback: function rollback() {\n      return sr.moveTo(recordStack.pop());\n    },\n    text: function text(bIndex, eIndex) {\n      return chAlls.slice(bIndex, eIndex).join('');\n    }\n  };\n  return sr;\n}\n\n//# sourceURL=webpack:///./lib2/Compiler/scanner/index.js?");

/***/ }),

/***/ "./lib2/index.js":
/*!***********************!*\
  !*** ./lib2/index.js ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var Compiler = __webpack_require__(/*! ./Compiler */ \"./lib2/Compiler/index.js\");\n\nvar compiler = new Compiler({\n  matchers: {\n    main: {\n      source: '<w>+',\n      source2: ' <objectField> | <jsExpression> '\n    },\n    objectField: {\n      source: \"\\n                '@' <objectFieldKey> ( ':' <dbFieldKey> )? <eol> | \\n                '@' <objectFieldKey> (\\n                    ' ' <objectFiledValueExpression> <eol> |\\n                    ( '(' <s>* ')' )? ( <map> | <list> | <block> ) |\\n                    '(' <listLength> ')' <list> |\\n                    ( ':' <dbTableName> )? '(' <dbSqlExpression>? ')' (\\n                        <map> | <list> | <block>\\n                    )\\n                )\\n            \",\n      before: function before(tb) {\n        return tb.objectFieldCreate();\n      },\n      done: function done(tb) {\n        return tb.objectFieldComplete();\n      },\n      document: function document(tb, text) {\n        return tb.documentCreate(text);\n      }\n    },\n    objectFieldKey: {\n      source: ' <w>+ ',\n      done: function done(tb, text) {\n        return tb.objectFieldSetKey(text);\n      }\n    },\n    objectFiledValueExpression: {\n      source: function source(sr) {\n        var hasMatched = false;\n\n        while (true) {\n          if (sr.read() === sr.EOL) {\n            sr.back();\n            break;\n          }\n\n          hasMatched = true;\n        }\n\n        return hasMatched;\n      },\n      done: function done(tb, text) {\n        return tb.objectFieldSetValueExpression(text);\n      }\n    },\n    map: {\n      source: \" \\n                '{' <eol> <dbFieldDefine>? <objectField>* '}' <eol> \\n            \",\n      before: function before(tb) {\n        return tb.mapCreate();\n      },\n      done: function done(tb) {\n        return tb.childCompile();\n      }\n    },\n    list: {\n      source: \"\\n                '[' <eol> <dbFieldDefine>? <objectField>* ']' <eol>\\n            \",\n      before: function before(tb) {\n        return tb.listCreate();\n      },\n      done: function done(tb) {\n        return tb.childCompile();\n      }\n    },\n    listLength: {\n      source: ' <d>+ ',\n      done: function done(tb, text) {\n        return tb.listSetLength(text);\n      }\n    },\n    block: {\n      source: \"\\n                '(:' <eol> <dbFieldDefine>? <blockExpression>* <valueReturnExpression> ':)' <eol> \\n            \",\n      before: function before(tb) {\n        return tb.block();\n      },\n      done: function done(tb) {\n        return tb.childCompile();\n      }\n    },\n    blockExpression: {\n      source: function source(sr) {\n        var text = [];\n\n        while (true) {\n          var cr = sr.read();\n\n          if (cr === sr.EOL) {\n            break;\n          }\n\n          text.push(cr);\n        }\n\n        var line = text.join('');\n\n        if (/^@|^:\\)$/.test(line)) {\n          return false;\n        }\n\n        return true;\n      },\n      done: function done(tb, text) {\n        return tb.setBlockExpression(text);\n      }\n    },\n    valueReturnExpression: {\n      source: function source(sr) {\n        if (sr.read() !== '@' || sr.read() !== ' ') {\n          return false;\n        }\n\n        while (true) {\n          if (sr.read() === sr.EOL) {\n            break;\n          }\n        }\n\n        return true;\n      },\n      done: function done(tb, text) {\n        return tb.setValueReturnExpression(text.slice(2, -1));\n      }\n    },\n    jsExpression: {\n      source: ' <.>+ <eol> ',\n      done: function done(tb, text) {\n        return tb.setJsExpression(text.slice(0, -1));\n      }\n    },\n    dbFieldKey: {\n      source: \"\\n                <w> (<w> | '.')*\\n            \",\n      done: function done(tb, text) {\n        return tb.dbSetFieldKey(text);\n      }\n    },\n    dbTableName: {\n      source: ' <w>+ ',\n      done: function done(tb, text) {\n        return tb.dbSetTableName(text);\n      }\n    },\n    dbSqlExpression: {\n      source: function source(sr) {\n        var hasMatched = false;\n        var isEscape = false; // 是否遇到转义反斜杠\n\n        var bkLength = 0; // 括号开启的次数\n\n        while (sr.notEOF()) {\n          var cr = sr.read();\n\n          if (isEscape) {\n            isEscape = false;\n          } else if (cr === '\\\\') {\n            isEscape = true;\n          } else if (cr === '(') {\n            bkLength++;\n          } else if (cr === ')') {\n            if (bkLength > 0) {\n              bkLength--;\n            } else {\n              // 结束\n              sr.back();\n              break;\n            }\n          }\n\n          hasMatched = true; // 任意长度，表示成功\n        }\n\n        return hasMatched;\n      },\n      done: function done(tb, text) {\n        return tb.dbSetSqlExpression(text);\n      }\n    },\n    dbFieldDefine: {\n      source: function source(sr) {\n        if (sr.read() !== '#') {\n          return false;\n        }\n\n        var text = [];\n\n        while (sr.notEOF()) {\n          var cr = sr.read();\n\n          if (cr === sr.EOL) {\n            break;\n          }\n\n          text.push(cr);\n        }\n\n        return /^\\(.+?\\)$/.test(text.join(''));\n      },\n      done: function done(tb, text) {\n        return tb.dbSetFieldDefine(text.slice(2, -2));\n      }\n    }\n  }\n});\nmodule.exports = {\n  compile: function compile(code) {\n    return compiler.run(code);\n  }\n};\n\n//# sourceURL=webpack:///./lib2/index.js?");

/***/ })

/******/ });